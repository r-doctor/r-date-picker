!function(e,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var t={};r(t),e.rdatepicker=t}}(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function c(e,r){for(var t=0;t<r.length;t++){var c=r[t];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}return function(e,r,t){return r&&c(e.prototype,r),t&&c(e,t),e}}(),c=!1,i=!1,d=null,n=[],u=null,y=null,p=0,h=0,k={year:"",month:"",date:"",hour:"",minute:"",second:""},s={"01":"一月","02":"二月","03":"三月","04":"四月","05":"五月","06":"六月","07":"七月","08":"八月","09":"九月",10:"十月",11:"十一月",12:"十二月"},a=["周日","周一","周二","周三","周四","周五","周六"],o=0,l="",m="",f="",b={type:"date",target:"web"};function v(e){return e%4!=0||e%100==0&&e%400!=0?[31,28,31,30,31,30,31,31,30,31,30,31]:[31,29,31,30,31,30,31,31,30,31,30,31]}function x(e,r,t){e.addEventListener(r,t)}function g(e,r,t){var c=document.createElement(e);for(var i in r)if("events"!==i)c.setAttribute(i,r[i]);else for(var n in r[i])x(c,n,r[i][n]);return t&&t.length&&t.forEach(function(e){!e.nodeType&&(e=document.createTextNode(e)),c.appendChild(e)}),c}function S(e){return e?e.replace(/\s{1,}$/,"").replace(/\s{1,}/g,"|").split("|"):[]}function q(e,r){return e.getAttribute(r)}function P(e){for(var r=[],t=Number(e),c=t+7,i=t-8;i<c;i++)r.push(i);return r}function C(e){return 9<e?""+e:"0"+e}function w(){var e=new Date,r=e.getFullYear(),t=e.getMonth()<9?"0"+(e.getMonth()+1):""+(e.getMonth()+1),c=e.getDate();return{year:r,month:t,date:c,hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),ymd:r+"-"+t+"-"+c}}function N(e){"none"===window.getComputedStyle(e,null).getPropertyValue("display")?e.style.display="block":e.style.display="none"}function r(e){e.style.display="block"}function M(e){e.style.display="none"}var T={initPicker:function(e){if(!i){var r=document.createDocumentFragment();r.appendChild(this.createPickerHeader()),r.appendChild(this.createPickerBody()),r.appendChild(this.createYearBox()),r.appendChild(this.createMonthBox()),e.appendChild(r),i=!0}},createPickerHeader:function(){var r=this,e=g("i",{class:"rd-picker-icon",events:{click:function(e){"block"!==d.querySelector("#rd-picker-year-box").style.display&&(k.year=k.year-1,r.refreshPicker())}}}),t=g("div",{class:"ym-text",id:"yearText",events:{click:function(){o=Number(k.year),f=o,N(d.querySelector("#rd-picker-year-box")),"month"!==y.type&&M(d.querySelector("#rd-picker-month-box")),d.querySelector("#rd-picker-year-box").replaceChild(r.createYearList(),d.querySelector("#rd-picker-year-list")),d.querySelector("#rd-picker-year-box").replaceChild(r.createYearNav(),d.querySelector("#rd-picker-year-nav"))}}},["2018"]),c=g("span",{class:"rd-picker-icon icon-next",events:{click:function(e){"block"!==d.querySelector("#rd-picker-year-box").style.display&&(k.year=Number(k.year)+1,r.refreshPicker())}}}),i=g("i",{class:"rd-picker-icon icon-pre",events:{click:function(e){"block"!==d.querySelector("#rd-picker-month-box").style.display&&(1==Number(k.month)?(k.year=k.year-1,k.month="12"):k.month=C(Number(k.month)-1),r.refreshPicker())}}}),n=g("div",{class:"ym-text",id:"monthText",events:{click:function(){m=k.month,d.replaceChild(r.createMonthBox(),d.querySelector("#rd-picker-month-box")),N(d.querySelector("#rd-picker-month-box")),M(d.querySelector("#rd-picker-year-box"))}}},["四月"]),a=g("i",{class:"rd-picker-icon icon-next",events:{click:function(e){"block"!==d.querySelector("#rd-picker-month-box").style.display&&(12==Number(k.month)?(k.year=Number(k.year)+1,k.month="01"):k.month=C(Number(k.month)+1),r.refreshPicker())}}});return g("div",{class:"rd-picker-header"},[g("div",{class:"rd-picker-change",id:"rd-picker-changer-year"},[e,t,c]),g("div",{class:"rd-picker-change",id:"rd-picker-changer-month"},[i,n,a])])},createPickerMask:function(){return g("div",{class:"rd-picker-mask",id:"rd-picker-mask",events:{click:function(e){M(e.target)}}})},createPickerBody:function(){var s=this,r=document.createDocumentFragment(),c=document.createDocumentFragment(),e=function(e,r){var t=[],c=new Date,i=c.getMonth();e=e||c.getFullYear(),r=r||C(i);var n=Number(r)-1,a=new Date(e+"-"+r+"-01").getDay(),o=a,l=a+v(Number(e))[n]-1,s=0,d=0,u=0;u=0==n?31-o:v(Number(e))[n-1]-o;for(var y=0;y<42;y++)o<=y&&y<=l?(t.push(s+1),s++):l<y?t.push(++d):t.push(++u);return p=o,h=l,t}(k.year,k.month);return a.forEach(function(e){r.appendChild(g("span",{class:"rd-picker-day"},[e]))}),e.forEach(function(e,r){var t="day-text";k.date&&k.date==e&&l===k.year+"-"+k.month+"-"+k.date&&(t+=" selected"),(r<p||h<r)&&(t+=" disabled"),c.appendChild(g("li",{class:"rd-picker-day-item"},[g("span",{class:t,events:{click:function(e){var r;if(k.date=(r=e.target.innerText).length<2?"0"+r:r,t=e.target,c="disabled",!((i=t.className)&&-1<S(i).indexOf(c))){var t,c,i,n,a,o;d.querySelector(".selected")&&function(e,r){var t=e.className;if(!t)return;var c=S(t);-1<c.indexOf(r)&&c.splice(c.indexOf(r),1),e.className=c.join(" ")}(d.querySelector(".selected"),"selected"),n=e.target,a="selected",o=n.className?n.className.replace(/\s{1,}$/,""):"",n.className=o+" "+a;var l="";"date"===y.type?l=k.year+"-"+k.month+"-"+k.date:"month"===y.type&&(l=k.year+"-"+k.month),y.selectCallback?y.selectCallback(l):u.value=l,M(d.querySelector("#rd-picker-year-box")),M(d.querySelector("#rd-picker-month-box")),setTimeout(function(){s.hidePicker(d),"mobile"===y.target&&M(document.querySelector("#rd-picker-mask"))},200)}}}},[e])]))}),g("div",{class:"rd-picker-body",id:"rd-picker-body"},[g("div",{class:"rd-picker-day-box"},[r]),g("ul",{class:"rd-picker-day-list"},[c])])},createPickerFooter:function(e){var r=this;return g("div",{class:"rd-picker-footer",id:"rd-picker-footer"},[g("button",{class:"picker-btn cancel-btn",events:{click:function(){r.hidePicker(d),M(d.querySelector("#rd-picker-year-box")),M(d.querySelector("#rd-picker-month-box"))}}},["取消"]),g("button",{class:"picker-btn confirm-btn",events:{click:function(){var e="";"date"===y.type?e=k.year+"-"+k.month+"-"+k.date:"month"===y.type&&(e=k.year+"-"+k.month),y.selectCallback?y.selectCallback(e):u.value=e,r.hidePicker(d),M(d.querySelector("#rd-picker-year-box")),M(d.querySelector("#rd-picker-month-box"))}}},["确定"])])},createYearBox:function(){return g("div",{class:"rd-picker-ym-box year",id:"rd-picker-year-box"},[this.createYearList(),this.createYearNav()])},createYearList:function(e){var t=this,r=e?P(e):k.year?P(k.year):[],c="";return r.length&&(c=document.createDocumentFragment(),r.forEach(function(e){var r="ym-text";f==e&&(r+=" selected"),c.appendChild(g("li",{class:"rd-picker-ym-item"},[g("span",{class:r,"data-year":e,events:{click:function(e){var r=q(e.target,"data-year");k.year=r,t.refreshPicker(),M(d.querySelector("#rd-picker-year-box"))}}},[e])]))})),g("ul",{class:"rd-picker-ym-list",id:"rd-picker-year-list"},[c])},createYearNav:function(e){var r=this;e||Number(k.year);return g("div",{class:"rd-picker-year-nav",id:"rd-picker-year-nav"},[g("button",{class:"year-nav-button pre-years",events:{click:function(){o-=15,d.querySelector("#rd-picker-year-box").replaceChild(r.createYearList(o),d.querySelector("#rd-picker-year-list"))}}},["上一页"]),g("button",{class:"year-nav-button next-years",style:"float: right;",events:{click:function(){o+=15,d.querySelector("#rd-picker-year-box").replaceChild(r.createYearList(o),d.querySelector("#rd-picker-year-list"))}}},["下一页"])])},createMonthBox:function(){var t=this,c=document.createDocumentFragment();return["01","02","03","04","05","06","07","08","09","10","11","12"].forEach(function(e){var r="ym-text";m==e&&(r+=" selected"),c.appendChild(g("li",{class:"rd-picker-ym-item"},[g("span",{class:r,"data-month":e,events:{click:function(e){var r=q(e.target,"data-month");k.month=r,"month"===y.type?(y.selectCallback?y.selectCallback(k.year+"-"+k.month):u.value=k.year+"-"+k.month,t.hidePicker(d)):t.refreshPicker(),M(d.querySelector("#rd-picker-month-box")),"mobile"===y.target&&M(document.querySelector("#rd-picker-mask"))}}},[s[e]])]))}),g("div",{class:"rd-picker-ym-box",id:"rd-picker-month-box"},[g("ul",{class:"rd-picker-ym-list"},[c])])},refreshPicker:function(e,r){if(e){var t=(i=e.split(" "),n=i[0],a=i[1],o=n.split("-"),l=["00","00","00"],a&&(l=a.split(":")),{year:o[0],month:o[1],date:o[2],hour:l[0],minute:l[1],second:l[2]});k=Object.assign({},k,t)}else if(r){var c=w();k=Object.assign({},k,c)}var i,n,a,o,l;"month"===y.type?document.querySelector("#yearText").innerText=k.year:(document.querySelector("#yearText").innerText=k.year,document.querySelector("#monthText").innerText=s[k.month],d.replaceChild(this.createPickerBody(),d.querySelector("#rd-picker-body")))},setPickerPosition:function(e,r){if("web"===y.target){var t=e.getBoundingClientRect(),c=window.innerWidth-t.left,i=window.innerHeight-(t.top+t.height);c<300?(r.style.left="initail",r.style.right=window.innerWidth-t.right+"px"):(r.style.right="initail",r.style.left=t.left+"px"),r.style.top=i<260?t.top-260+"px":t.top+t.height+"px"}else r.style.left="0",r.style.bottom="0",r.style.width="100%"},showPicker:function(e){e.style.display="block"},hidePicker:function(e){e.style.display="none"},destoryPicker:function(e){e&&e.remove()},resetPicker:function(){d.style.height="260px","mobile"===y.target&&r(document.querySelector("#rd-picker-mask")),"month"===y.type?(d.querySelector("#rd-picker-changer-year").style.width="100%",M(d.querySelector("#rd-picker-changer-month")),M(d.querySelector("#rd-picker-body")),r(d.querySelector("#rd-picker-month-box"))):(d.querySelector("#rd-picker-changer-year").style.width="50%",r(d.querySelector("#rd-picker-changer-month")),r(d.querySelector("#rd-picker-body")),M(d.querySelector("#rd-picker-month-box")))}},Y=function(){function r(e){if(function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),!e.ele)throw new Error("You must provide a DOM element!");this.opts=Object.assign({},b,e),this.ele=this.opts.ele,this.init(),n.push(this.ele),!c&&(c=!0)}return t(r,[{key:"init",value:function(){var e=this;if(!c){var r=g("div",{id:"rd-picker-container",class:"rd-picker-container"});document.body.appendChild(T.createPickerMask()),document.body.appendChild(r),T.initPicker(r),d=r}x(this.ele,"click",function(){console.log("click"),u=e.ele,y=e.opts,l=u.value||w().ymd,f=u.value?u.value.split("-")[0]:w().year,m=u.value?u.value.split("-")[1]:w().month,"month"===y.type&&d.replaceChild(T.createMonthBox(),d.querySelector("#rd-picker-month-box")),T.setPickerPosition(e.ele,d),T.refreshPicker(l,!0),T.resetPicker(),T.showPicker(d)})}},{key:"destory",value:function(){T.destoryPicker(d)}}]),r}();x(document,"click",function(e){var r,t;-1==n.indexOf(e.target)&&e.target!==d&&d&&(r=e.target,t=d,10!==r.compareDocumentPosition(t))&&(T.hidePicker(d),M(d.querySelector("#rd-picker-year-box")),M(d.querySelector("#rd-picker-month-box")))}),e.default=Y});